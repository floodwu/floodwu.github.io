# 定时器和时间管理

内核中有大量的函数都是基于时间驱动的，其中有一些是周期执行的，比如对调度程序中的运行队列进行平衡调整、刷新屏幕、检测当前进程是否用尽了自己的时间片等。另一些则需要等待一个相对时间后才运行，比如要推后执行的IO操作等。除了这两种情况，内核还必须管理系统的运行时间以及当前时间。

周期性产生的事件都是由系统定时器驱动的，·系统定时器是一种可编程的硬件芯片，它能以固定频率产生中断·，该中断就是所谓的定时器中断，它所对应的中断处理程序负责更新系统时间，也负责执行需要周期性运行的任务。

内核必须在硬件（系统定时器）的帮助下才能计算和管理时间。系统定时器以某种频率自行触发，该频率可以通过编程预定，连续两次时钟中断的时间间隔就称为节拍（tick）。系统定时器的频率是通过静态预处理定义的，也称为HZ（赫兹），体系结构不同HZ值也不同。

自Linux问世以来，i386体系结构的时钟中断频率就设定为100HZ，但是在2.5开发版内核中，被提高到1000HZ。提高节拍率等同于提高中断解析度，比如HZ=100的时钟的执行粒度为10ms，即系统中的周期事件最快为10ms运行一次，而不能有更高的精度（因而存在时间误差），但是当HZ=1000时，解析度就为1ms。劣势在于，频率越高，系统的负担越重，因为处理器必须花时间来执行时钟中断处理程序，此外还会更频繁地打乱处理器高速缓存，并增加耗电。

Linux内核也支持无节拍操作，当编译内核的时候设置了CONFIG_HZ配置选项，系统就根据这个选项动态调度时钟中断（按需动态调度和重新设置），而不是每隔固定时间间隔触发时钟中断。最大的好处在于省电。
# 内核中有可能造成并发执行的原因

`临界区`就是访问和操作共享数据的代码段，如果两个执行线程有可能处于同一个临界区中同时（交错地）执行，就称为`竞争条件`，避免和防止竞争条件称为`同步`。

处理器提供了指令来原子地读变量、增加变量、写回变量，两个原子操作不可能交错执行。锁也是采用原子操作实现的，因此锁操作不存在竞争。

## 内核中有可能造成并发执行的原因：
中断：中断几乎可以在任何时刻异步发生，也就可能随时打断当前正在执行的代码；
软中断和tasklet：内核能在任何时刻唤醒或者调度软中断和tasklet，打断当前正在执行的代码；
内核抢占：因为内核具有抢占性，所以内核中的任务可能会被另一个任务抢占；
睡眠及与用户空间的同步：在内核执行的进程可能会睡眠，这就会唤醒调度程序，从而导致另一个新的用户进程执行；
对称多处理：两个或者多个处理器可以同时执行代码；

用户空间之所以需要同步，是因为用户程序会被调度程序抢占和重新调度，造成一个程序正处于临界区时被非自愿地抢占了。而新的线程可能会访问同样的临界区。

用锁来保护共享资源并不困难，辨认出真正需要共享的数据和相应的临界区才是真正有挑战的地方。
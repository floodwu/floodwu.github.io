# 字符设备、块设备

## 字符设备
字符设备按照字节流的方式被有序访问，比如串口、键盘等。

## 块设备
能够随机访问（数据顺序在设备上不一定要连续）访问固定大小数据片的硬件设备称为块设备，这些固定大小的数据片就称为块。块设备都是以安装文件系统的方式使用的。常见的块设备有硬盘、蓝光光驱、闪存等。
内核管理块设备比管理字符设备复杂得多，因为字符设备仅仅需要控制一个位置，即当前位置，而块设备访问的位置必须能够在介质的不同区间前后移动。事实上内核不必提供一个专门的子系统来管理字符设备，但是对块设备的管理却必须要有一个专门的提供服务的子系统。

## 扇区
块设备中最小的可寻址单元为扇区，块设备无法对比它还小的单元进行寻址和操作。扇区大小是设备的物理属性，一般为2的整数倍，通常为512字节。
块是文件系统的一种抽象，只能基于块来访问文件系统。虽然物理磁盘的寻址是按照扇区级进行的，但是内核执行的所有磁盘操作都是按照块进行的，块通常数倍于扇区大小，且不能超过一个页的长度。

## 缓冲区头
在读入后或等待写出时，一个块会被调入内存，并存储在一个缓冲区中，每个缓冲区与一个块对应，它相当于是磁盘块在内存中的表示。每个缓冲区都有一个对应的描述符，用buffer_head结构体表示，称作缓冲区头。缓冲区头的目的在于描述磁盘块和物理内存缓冲区之间的映射关系。

## bio结构体
内核中块I/O操作的基本容器由bio结构体表示，该结构体代表了正在现场的（活动的）以片段链表形式组织的块I/O操作。一个片段是一小块连续的内存缓冲区。通过片段来描述缓冲区，即使一个缓冲区分散在内存的多个位置上，bio结构体也能对内核保证I/O操作的执行。每一个块I/O请求都通过一个bio结构体表示，每个请求包含一个或多个块，这些块被存储在bio结构体的bio_vec域中。

## 请求队列
块设备将它们挂起的I/O请求保存在请求队列中，该队列由request_queue结构体表示。内核中的高层代码，如文件系统将请求加入到队列中，只要队列不为空，队列对应的块设备驱动程序就会从队列头获取请求，然后将其送入对应的块设备上去。队列中的请求由结构体request表示，因为一个请求可能要操作多个连续的磁盘块，所以每个请求可以由多个bio结构体组成。
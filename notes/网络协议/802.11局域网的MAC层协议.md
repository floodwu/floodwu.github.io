# 802.11局域网的MAC层协议

## CSMA/CA 协议 
无线局域网却不能简单地搬用 CSMA/CD 协议。这里主要有两个原因。
1.CSMA/CD 协议要求一个站点在发送本站数据的同时，还必须不间断地检测信道，但在无线局域网的设备中要实现这种功能就花费过大。
2.即使我们能够实现碰撞检测的功能，并且当我们在发送数据时检测到信道是空闲的，在接收端仍然有可能发生碰撞。  
这种未能检测出媒体上已存在的信号的问题叫做隐蔽站问题(hidden station problem) 。当 A 和 C 检测不到无线信号时，都以为 B 是空闲的，因而都向 B 发送数据，结果发生碰撞。
![image](https://github.com/woojean/woojean.github.io/blob/master/images/wangluo38.png)

当 A 和 C 检测不到无线信号时，都以为 B 是空闲的，因而都向 B 发送数据，结果发生碰撞。
其实 B 向 A 发送数据并不影响 C 向 D 发送数据这就是暴露站问题(exposed station problem) 
![image](https://github.com/woojean/woojean.github.io/blob/master/images/wangluo39.png)

B 向 A 发送数据，而 C 又想和 D 通信。C 检测到媒体上有信号，于是就不敢向 D 发送数据。 

## CSMA/CA 协议的原理 
欲发送数据的站先检测信道。在 802.11 标准中规定了在物理层的空中接口进行物理层的载波监听。
通过收到的相对信号强度是否超过一定的门限数值就可判定是否有其他的移动站在信道上发送数据。
当源站发送它的第一个 MAC 帧时，若检测到信道空闲，则在等待一段时间 DIFS 后就可发送。  

## 为什么信道空闲还要再等待 
这是考虑到可能有其他的站有高优先级的帧要发送。
如有，就要让高优先级帧先发送。

## 假定没有高优先级帧要发送 
源站发送了自己的数据帧。
目的站若正确收到此帧，则经过时间间隔 SIFS 后，向源站发送确认帧 ACK。
若源站在规定时间内没有收到确认帧 ACK（由重传计时器控制这段时间），就必须重传此帧，直到收到确认为止，或者经过若干次的重传失败后放弃发送。

## 虚拟载波监听 
虚拟载波监听(Virtual Carrier Sense)的机制是让源站将它要占用信道的时间（包括目的站发回确认帧所需的时间）通知给所有其他站，以便使其他所有站在这一段时间都停止发送数据。这样就大大减少了碰撞的机会。 
“虚拟载波监听”是表示其他站并没有监听信道，而是由于其他站收到了“源站的通知”才不发送数据。
所谓“源站的通知”就是源站在其 MAC 帧首部中的第二个字段“持续时间”中填入了在本帧结束后还要占用信道多少时间（以微秒为单位），包括目的站发送确认帧所需的时间。 

## 对信道进行预约 
源站 A 在发送数据帧之前先发送一个短的控制帧，叫做请求发送 RTS (Request To Send)，它包括源地址、目的地址和这次通信（包括相应的确认帧）所需的持续时间。
若媒体空闲，则目的站 B 就发送一个响应控制帧，叫做允许发送 CTS (Clear To Send)，它包括这次通信所需的持续时间（从 RTS 帧中将此持续时间复制到 CTS 帧中）。

## 802.11 局域网的 MAC 帧
802.11 帧共有三种类型，即控制帧、数据帧和管理帧。
数据帧的三大部分 
1.MAC 首部，共 30 字节。帧的复杂性都在帧的首部。
2.帧主体，也就是帧的数据部分，不超过2312 字节。这个数值比以太网的最大长度长很多。不过 802.11 帧的长度通常都是小于 1500 字节。
3.帧检验序列 FCS 是尾部，共 4 字节
802.11 数据帧最特殊的地方就是有四个地址字段。地址 4 用于自组网络。
# 处理任务亲和力

亲和力表明了一个activity＂心仪＂哪个任务．默认下，属于同一个应用的所有activitie之间具有相同的任务亲和力．所以，默认下，一个应用的所有activitie首选属于同一任务．然而，你可以修改一个activity的默认任务亲和力．定义于不同应用的Activitie可以具有相同的任务亲和力，或者同一应用中的activitie可以分配不同的任务亲和力．
你可以使用<activity>元素的taskAffinity属性来修改一个activity的任务亲和力．taskAffinity属性使用字符串作为值，这个字符串必须与在<manifest>中声明的默认包名不同，因为系统使用包名来标识默认的任务亲和力．
亲和力在以下两种情况起作用：
•当启动一个activity的intent包含FLAG_ACTIVITY_NEW_TASK标志．
一个新的activity默认是在调用startActivity()的activity所在的任务中安置．然而，如果传给startActivity()的intent包含了FLAG_ACTIVITY_NEW_TASK标志，系统就会查找另一个能安置这个新activity的任务．通常，它会是一个新任务．然而但是，并不是必须这样做．如果有一个已存在的任务具有与新activity相同的亲和力，那么这个activity就被启动并安置到这个已存在的任务中．如果没有这样的任务，才开始一个新的任务．如果这个标志导致了一个activity在一个新的任务中启动然后用户按下了HOME键离开了这个新任务，那么必须有一些方法使得用户可以重新回到这个任务．一些实体(比如通知管理器)总是在一个另外的任务中启动activity而从不作为自己任务的一部分，于是它总是把FLAG_ACTIVITY_NEW_TASK设置到传给startActivity()的intents中．如果你有一个activity可以被外部实体使用这个标志调用，应小心用户可能用一个独立的方法回到这个启动的任务，比如使用启动图标（任务的根activity有一个CATEGORY_LAUNCHERintent 过滤器）．－翻译得挺难受，这句话也就是说，只要使用了相同的亲和力，用户就能回到这个已启动的任务中．
•当一个activity的allowTaskReparenting属性为"true"时．
在此情况下，activity可以从启动它的任务移动到一个亲和的任务中，当后一个任务来到前台时．例如，假设一个报告所选城市的天气状况的activity是作为一个旅游应用的一部分．它与同一个应用中的其它activity具有相同的亲和力(默认的application亲合力)并且它被允许重认父母．当你的一个activity启动了这个天气预报activity，它起初是与你的actvity属于同一个任务．然而，当旅游应用的任务进入前台时，天气预报activity就被重新分配到这个任务并在其只显示．
小提示:：如果一个.apk文件包含多个从用户角度所认为的"应用"，你可能想通过为activity指定属性taskAffinity来使它们连接到不同的"应用"．
# Framework框架

框架中包含三个主要部分，分别为服务端、客户端和Linux驱动。
服务端主要包含两个重要类，分别是WindowManagerService（WmS）和ActivityManagerService（AmS），此外服务端还包括两个消息处理类：KeyQ类（WmS的内部类）和InputDispatcherThread类。WmS的作用是为所有的应用程序分配窗口，并管理这些窗口，包括分配窗口的大小，调节各窗口的叠放层次，隐藏或者显示窗口；AmS的作用是管理所有应用程序中的Activity；KeyQ类继承于KeyInputQueue类，一旦创建就立即启动一个线程，该线程会不断地读取用户的UI操作消息，并把这些消息放到一个消息队列QueueEvent类中；InputDispatcherThread类一旦创建也会立即启动一个线程不断地从QueueEvent中取出用户消息，并进行一定的过滤，再将这些消息发送给当前活动的客户端程序中。
客户端主要包括以下重要类：
ActivityThread类，为应用程序的主线程类，所有的APK程序都有且仅有一个该类，程序的入口为该类中的static main()函数；
Activity类，为APK程序的最小运行单元，ActivityThread主类会根据用户操作选择运行哪个Activity对象；
PhoneWindow类，继承于Window类，同时内部包含一个DecorView对象。PhoneWindow是把一个FrameLayout进行了一定的包装，并提供了一组通用的窗口操作接口；
Window类，是一个抽象类，提供了一组通用的窗口操作API，这里的窗口指一个View或者ViewGroup类，一般就是指DecorView类，即一个DecorView就是Wms所管理的一个窗口（WmS所管理的窗口并不是Window类）；
DecorView类，是FrameLayout的一个子类，并且是PhoneWindow中的一个内部类，就是对普通FrameLayout进行了一定的修饰，如添加一个通用的Title bar，并响应特定的按键消息；
ViewRoot类，继承于Handler，主要用来接收WmS的异步消息，并通知客户端进行某种操作，以此实现WmS对客户端窗口的管理；每个客户端的窗口都会对应一个ViewRoot类；
W类，ViewRoot的一个内部类，继承于Binder，用于向WmS提供一个IPC接口，从而让WmS控制窗口客户端的行为；
WindowManager类，和WmS进行交互，客户端不能直接和WmS进行交互；
Linux驱动和Framework相关的主要包含两部分：SurfaceFlingger和Binder；每一个窗口都对应一个Surface，SF驱动的作用就是把各个Surface显示在同一个屏幕上。
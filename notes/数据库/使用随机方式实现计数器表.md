# 使用随机方式实现计数器表

如下的网站点击统计计数器表存在并发问题：

```
CREATE TABLE hit_counter(
  cnt int unsigned not null
) ENGINE=InnoDB;
```
当网站发生点击时：
```
UPDATE hit_counter SET cnt = cnt + 1;
```
要获得更高的并发更新性能，可以将数据器保存在多行中，每次随机选择一行进行更新，修改计数器表如下：
```
CREATE TABLE hit_counter(
  slot tinyint unsigned not null primary key,
  cnt int unsigned not null
)ENGINE=InnoDB;
```
当发生更新操作时，选择一个随机的行进行更新：
```
UPDATE hit_counter SET cnt = cnt + 1 WHERE slot = RAND() * 100;
```
如下获取统计结果：
```
SELECT SUM(cnt) FROM hit_counter;
```
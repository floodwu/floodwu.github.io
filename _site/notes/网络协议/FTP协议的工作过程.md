# FTP协议的工作过程

文件传送协议 FTP 只提供文件传送的一些基本的服务，它使用 TCP 可靠的运输服务。
FTP 的主要功能是`减少或消除在不同操作系统下处理文件的不兼容性`。
FTP 使用客户服务器方式。一个 FTP 服务器进程可同时为多个客户进程提供服务。FTP 的服务器进程由两大部分组成：一个主进程，负责接受新的请求；另外有若干个从属进程，负责处理单个请求。

## 主进程的工作步骤如下
1.打开熟知端口（端口号为 21），使客户进程能够连接上。
2.等待客户进程发出连接请求。
3.启动从属进程来处理客户进程发来的请求。从属进程对客户进程的请求处理完毕后即终止，但从属进程在运行期间根据需要还可能创建其他一些子进程。
4.回到等待状态，继续接受其他客户进程发来的请求。主进程与从属进程的处理是并发地进行。

## 两个TCP 连接
控制连接在整个会话期间一直保持打开，FTP 客户发出的传送请求通过控制连接发送给服务器端的控制进程，但控制连接不用来传送文件。
实际用于传输文件的是“数据连接”。服务器端的控制进程在接收到 FTP 客户发送来的文件传输请求后就创建“数据传送进程”和“数据连接”，用来连接客户端和服务器端的数据传送进程。
数据传送进程实际完成文件的传送，在传送完毕后关闭“数据传送连接”并结束运行。

## 两个不同的端口号 
当客户进程向服务器进程发出建立连接请求时，要寻找连接服务器进程的熟知端口(21)，同时还要告诉服务器进程自己的另一个端口号码，用于建立数据传送连接。
接着，服务器进程用自己传送数据的熟知端口(20)与客户进程所提供的端口号码建立数据传送连接。
由于 FTP 使用了两个不同的端口号，所以数据连接与控制连接不会发生混乱。
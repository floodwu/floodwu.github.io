# IP数据报的格式 

一个 IP 数据报由首部和数据两部分组成。
首部的前一部分是固定长度，共 20 字节，是所有 IP 数据报必须具有的。
在首部的固定部分的后面是一些可选字段，其长度是可变的。
![image](https://github.com/woojean/woojean.github.io/blob/master/images/wangluo6.png)

1.`版本`——占 4 位，指 IP 协议的版本目前的 IP 协议版本号为 4 (即 IPv4)
2.`首部长度`——占 4 位，可表示的最大数值是 15 个单位(一个单位为 4 字节)因此 IP 的首部长度的最大值是 60 字节。
3.`区分服务`——占 8 位，用来获得更好的服务在旧标准中叫做服务类型，但实际上一直未被使用过。
4.`总长度`——占 16 位，指首部和数据之和的长度，单位为字节，因此数据报的最大长度为 65535 字节。总长度必须不超过最大传送单元 MTU。 
5.`标识`(identification)    占 16 位，它是一个计数器，用来产生数据报的标识。 
6.`标志`(flag)    占 3 位，目前只有前两位有意义。标志字段的最低位是 MF (More Fragment)。
MF  1 表示后面“还有分片”。MF  0 表示最后一个分片。标志字段中间的一位是 DF (Don't Fragment) 。
只有当 DF  0 时才允许分片。 
7.`片偏移`(12 位)指出：较长的分组在分片后某片在原分组中的相对位置。片偏移以 8 个字节为偏移单位。
IP 数据报分片举例：
![image](https://github.com/woojean/woojean.github.io/blob/master/images/wangluo7.png)

8.`生存时间`(8 位)记为 TTL (Time To Live)数据报在网络中可通过的路由器数的最大值。
9.`协议`(8 位)字段指出此数据报携带的数据使用何种协议以便目的主机的 IP 层将数据部分上交给哪个处理过程
10.`首部检验和`(16 位)字段只检验数据报的首部不检验数据部分。
11.`源地址`和`目的地址`都各占 4 字节
12.IP 数据报首部的可变部分：
IP 首部的可变部分就是一个选项字段，用来支持排错、测量以及安全等措施，内容很丰富。
选项字段的长度可变，从 1 个字节到 40 个字节不等，取决于所选择的项目。
增加首部的可变部分是为了增加 IP 数据报的功能，但这同时也使得 IP 数据报的首部长度成为可变的。这就增加了每一个路由器处理数据报的开销。
实际上这些选项很少被使用。 
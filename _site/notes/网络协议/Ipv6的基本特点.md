# Ipv6的基本特点

## 要解决 IP 地址耗尽的问题的措施
1.采用无类别编址 CIDR，使 IP 地址的分配更加合理。
2.采用网络地址转换 NAT 方法以节省全球 IP 地址。
3.采用具有更大地址空间的新版本的 IP 协议 IPv6。  

## IPv6 的基本首部 
IPv6 数据报的首部
1.IPv6 将首部长度变为固定的 40 字节，称为基本首部(base header)。
2.将不必要的功能取消了，首部的字段数减少到只有 8 个。
3.取消了首部的检验和字段，加快了路由器处理数据报的速度。
4.在基本首部的后面允许有零个或多个扩展首部。
5.所有的扩展首部和数据合起来叫做数据报的有效载荷(payload)或净负荷。    

## IPv6 数据报的一般形式 
![image](https://github.com/woojean/woojean.github.io/blob/master/images/wangluo41.png)

1.版本(version)—— 4 位。它指明了协议的版本，对 IPv6 该字段总是 6。 
2.通信量类(traffic class)—— 8 位。这是为了区分不同的 IPv6 数据报的类别或优先级。目前正在进行不同的通信量类性能的实验。 
3.流标号(flow label)—— 20 位。 “流”是互联网络上从特定源点到特定终点的一系列数据报， “流”所经过的路径上的路由器都保证指明的服务质量。所有属于同一个流的数据报都具有同样的流标号。 
4.有效载荷长度(payload length)—— 16 位。它指明 IPv6 数据报除基本首部以外的字节数（所有扩展首部都算在有效载荷之内），其最大值是 64 KB。 
5.下一个首部(next header)—— 8 位。它相当于 IPv4 的协议字段或可选字段。 
6.跳数限制(hop limit)—— 8 位。源站在数据报发出时即设定跳数限制。路由器在转发数据报时将跳数限制字段中的值减1。当跳数限制的值为零时，就要将此数据报丢弃。 
7.源地址—— 128 位。是数据报的发送站的 IP 地址。 
8.目的地址—— 128 位。是数据报的接收站的 IP 地址。 

## IPv6 的扩展首部
IPv6 把原来 IPv4 首部中选项的功能都放在扩展首部中，并将扩展首部留给路径两端的源站和目的站的主机来处理。
数据报途中经过的路由器都不处理这些扩展首部（只有一个首部例外，即逐跳选项扩展首部）。
这样就大大提高了路由器的处理效率。

## 六种扩展首部 
1.逐跳选项
2.路由选择
3.分片
4.鉴别
5.封装安全有效载荷
6.目的站选项

## 无扩展首部
![image](https://github.com/woojean/woojean.github.io/blob/master/images/wangluo42.png)


## 有扩展首部
![image](https://github.com/woojean/woojean.github.io/blob/master/images/wangluo43.png)


## 扩展首部举例
IPv6 把分片限制为由源站来完成。源站可以采用保证的最小 MTU（1280字节），或者在发送数据前完成路径最大传送单元发现(Path MTU Discovery)，以确定沿着该路径到目的站的最小 MTU。
分片扩展首部的格式如下：
![image](https://github.com/woojean/woojean.github.io/blob/master/images/wangluo44.png)

IPv6 数据报的有效载荷长度为 3000 字节。下层的以太网的最大传送单元 MTU 是 1500 字节。
分成三个数据报片，两个 1400 字节长，最后一个是 200 字节长。  
![image](https://github.com/woojean/woojean.github.io/blob/master/images/wangluo45.png)



## IPv6 的地址空间
地址的类型与地址空间 
IPv6 数据报的目的地址可以是以下三种基本类型地址之一：
(1) 单播(unicast)     单播就是传统的点对点通信。
(2) 多播(multicast)   多播是一点对多点的通信。
(3) 任播(anycast)    这是 IPv6 增加的一种类型。任播的目的站是一组计算机，但数据报在交付时只交付其中的一个，通常是距离最近的一个。 

## 结点与接口
IPv6 将实现 IPv6 的主机和路由器均称为结点。
IPv6 地址是分配给结点上面的接口。
一个接口可以有多个单播地址。
一个结点接口的单播地址可用来唯一地标志该结点。

## 冒号十六进制记法 (colon hexadecimal notation) 
每个 16 位的值用十六进制值表示，各值之间用冒号分隔。
68E6:8C64:FFFF:FFFF:0:1180:960A:FFFF
零压缩(zero compression)，即一连串连续的零可以为一对冒号所取代。 
FF05:0:0:0:0:0:0:B3     可以写成：
FF05::B3

## 点分十进制记法的后缀 
0:0:0:0:0:0:128.10.2.1 再使用零压缩即可得出：  ::128.10.2.1
CIDR 的斜线表示法仍然可用。
60 位的前缀 12AB00000000CD3 可记为：
   12AB:0000:0000:CD30:0000:0000:0000:0000/60
或12AB::CD30:0:0:0:0/60
或12AB:0:0:CD30::/60   

## 地址空间的分配
IPv6 将 128 位地址空间分为两大部分。
第一部分是可变长度的类型前缀，它定义了地址的目的。
第二部分是地址的其余部分，其长度也是可变的。

## 特殊地址 
未指明地址这是 16 字节的全 0 地址，可缩写为两个冒号“::”。这个地址只能为还没有配置到一个标准的 IP 地址的主机当作源地址使用。
环回地址即 0:0:0:0:0:0:0:1（记为 ::1）。
基于 IPv4 的地址前缀为 0000 0000 保留一小部分地址作为与 IPv4 兼容的。
本地链路单播地址   

前缀为 0000 0000 的地址 前缀为 0000 0000 是保留一小部分地址与 IPv4 兼容的，这是因为必须要考虑到在比较长的时期 IPv 4和 IPv6 将会同时存在，而有的结点不支持 IPv6。
因此数据报在这两类结点之间转发时，就必须进行地址的转换。

## 全球单播地址的等级结构 
IPv6 扩展了地址的分级概念，使用以下三个等级：
(1) 全球路由选择前缀，占 48 位。 
(2) 子网标识符，占16 位。 
(3) 接口标识符，占 64 位。

## EUI-64 
IEEE定 义了一个标准的 64 位全球唯一地址格式 EUI-64。
EUI-64 前三个字节（24 位）仍为公司标识符，但后面的扩展标识符是五个字节（40 位）。
较为复杂的是当需要将 48 位的以太网硬件地址转换为 IPv6 地址。   

## 把以太网地址转换为 IPv6 地址 
![image](https://github.com/woojean/woojean.github.io/blob/master/images/wangluo46.png)


## 从 IPv4 向 IPv6 过渡 
向 IPv6 过渡只能采用逐步演进的办法，同时，还必须使新安装的 IPv6 系统能够向后兼容。
IPv6 系统必须能够接收和转发 IPv4 分组，并且能够为 IPv4 分组选择路由。
双协议栈(dual stack)是指在完全过渡到 IPv6 之前，使一部分主机（或路由器）装有两个协议栈，一个 IPv4 和一个 IPv6。  
使用隧道技术从 IPv4 到 IPv6 过渡 
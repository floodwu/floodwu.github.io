# 页、区

## 页（page）
内核把物理页做为内存管理的基本单元：内存管理单元（MMU，管理内存并把虚拟地址转换为物理地址的硬件）以页为单位来管理系统中的页表，`从虚拟内存的角度来看，页就是最小单位`。体系结构不同，支持的页大小也不尽相同，大多数32位体系结构支持4KB的页，因此在支持4KB页大小并有1GB物理内存的机器上，物理内存会被划分为262144个页。

内核中用struct page结构表示系统中的每个物理页，该数据结构用于描述物理内存本身，而不是描述包含在其中的数据。其中有一个flags域用来表示页的状态，比如页是不是脏的、是不是被锁定在内存中，等等。flags中的每一位单独表示一种状态，因此它至少可以同时表示出32种不同的状态。_count域用于表示`页的引用计数`，当计数变为-1时，就说明当前内核并没有引用这一页，于是可以用于新的内存分配。virtual域表示页的`虚拟地址`，即页在虚拟内存中的地址。

## 区（zone）
由于硬件存在如下引起内存寻址问题的缺陷，所以内核使用区从逻辑上对具有相似特性的页进行分组，主要是以下缺陷：
1.	一些硬件只能用某些特定的内存地址来执行内存直接访问；
 2.一些体系结构的内存物理寻址范围比虚拟寻址范围大得多，这样就有一些内存不能永久地映射到内核空间上；

## Linux主要使用了4种区：
1.ZONE_DMA：这个区包含的页能用来执行内存直接访问操作；
2.ZONE_DMA32：和ZONE_DMA类似，主要区别在于这些页面只能被32位设备访问；
3.ZONE_NORMAL：这个区包含的都是能正常映射的页；
4.ZONE_HIGHEM：这个区包含“高端内存”，其中的页并不能永久地映射到内核地址空间。
区的实际使用和分布是与体系结构相关的。

区使用struct zone表示，lock域是一个自旋锁，用来防止该结构被并发访问。watermark数组持有该区的最小值、最高和最低水位值，内核使用水位为每个内存区设置合适的内存消耗基准，该水位值随空闲的内存的多少而变化。name是一个表示区名字的字符串，内核启动期间会初始化这个值。

## 获得页的接口
内核提供了一种请求内存的底层机制，以及对它进行访问的一组接口，所有这些接口都以页为单位分配内存，如：
	struct page * alloc_pages(…);		/* 分配连续的物理页 */
	void * page_address(struct page * pages);	/* 把给定的页转换成它的逻辑地址 */
	（分配、释放函数，略）
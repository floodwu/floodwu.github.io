# 注入攻击的各种形式及防御手段

注入攻击的本质是把用户的数据当做代码执行。这里有两个关键条件：
1.用户能够控制输入；
2.原本程序要执行的代码拼接了用户输入的数据；

## SQL注入
例如：
```
var sql = "select * from OrderTable where ShipCity = '" + ShipCity + "'";
```
变量ShipCity由用户提交，而用户提交如下的值：
```
Beijing';drop table OrderTable;
```
如果Web服务器开启了错误回显，则会加大SQL注入的风险。

## 盲注（Blind Injection）
盲注即在服务器没有错误回显时使用盲注验证的方法完成注入攻击。
即根据页面参数构造不同的查询条件来猜测，详略。

## Timing Attack
盲注的一种，利用MySQL的BENCHMARK()函数可以让同一个函数执行若干次，使得结果返回的时间比平时要长，通过时间长短的变化，可以判断出注入语句是否执行成功。
比如当页面基于id查询时，可以构造如下的id：
```
1170 UNION SELECT IP(SUBSTRING(current,1,1))=CHAR(119),BENCHMARK(5000000,ENCODE('MSG','by 5 seconds')),null) FROM (Select Database() as current) as tb1;
```
以上代码判断库名的第一个字母是否为'w'，如果为真，则BENCKMARK()函数将造成较长时间的延迟，否则会很快执行完。

## 常见攻击技巧
繁琐，略。

## 正确地防御SQL注入
1.使用预编译语句绑定变量（最佳方式）；
2.使用安全的存储过程；
3.检查数据类型；
4.使用安全函数；

## 其他注入攻击
1.XML注入，详略。
2.代码注入，详略。
3.CRLF注入：凡是使用CRLF作为分隔符的地方都可能存在注入问题，比如log注入、HTTP头注入（截断HTTP头中，比如Set-Cookie，插入JavaScript代码）；假如服务器没有过滤‘\r\n’，而又把用户输入的数据放在HTTP头中，则可能导致这种安全隐患。
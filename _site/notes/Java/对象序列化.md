# 对象序列化

只要对象实现了Serializable接口（一个标记接口），对象的序列化处理就会非常简单。要序列化一个对象首先要创建一个OutputStream对象，然后将其封装在一个ObjectOutputStream对象内，之后只要调用writeObject()即可将对象序列化，并将其发送给OutputStream（对象序列化是基于字节的，因此要使用InputStream和OutputStream继承层次结构）。

对象序列化能够追踪对象内所包含的所有引用，并保存那些对象，接着对对象内包含的每个这样的引用进行追踪（Java序列化机制用优化的算法自动维护整个对象网）。

可以通过实现Externalizable接口（代替Serializable）来对序列化过程进行控制，该接口包含两个方法writeExternal()和readExternal()，这两个方法会在序列化和反序列化还原的过程中被自动调用。

对于Serializable对象，完全以其存储的二进制位为基础来反序列化对象，而不会调用构造器。但是对于Externalizable对象，只会调用默认构造器，然后调用readExternal()。
```java
import java.io.*;
import static net.mindview.util.Print.*;

public class Blip3 implements Externalizable {
  private int i;
  private String s; // No initialization

  public Blip3() {
    print("Blip3 Constructor"); // s, i not initialized
  }
  public Blip3(String x, int a) {
    print("Blip3(String x, int a)");
    s = x;
    i = a;
    // s & i initialized only in non-default constructor.
  }
  public String toString() { return s + i; }
  public void writeExternal(ObjectOutput out) throws IOException {
    print("Blip3.writeExternal");
    // You must do this:
    out.writeObject(s);
    out.writeInt(i);
  }
  public void readExternal(ObjectInput in) 
    throws IOException, ClassNotFoundException {
    print("Blip3.readExternal");
    // You must do this:
    s = (String)in.readObject();
    i = in.readInt();
  }
  public static void main(String[] args)
  throws IOException, ClassNotFoundException {
    print("Constructing objects:");
    Blip3 b3 = new Blip3("A String ", 47);
    print(b3);

    // 序列化
    ObjectOutputStream o = new ObjectOutputStream(
      new FileOutputStream("Blip3.out"));
    print("Saving object:");
    o.writeObject(b3);
    o.close();

    // 反序列化
    ObjectInputStream in = new ObjectInputStream(
      new FileInputStream("Blip3.out"));
    print("Recovering b3:");
    b3 = (Blip3)in.readObject();
    print(b3);
  }
} /* Output:
Constructing objects:
Blip3(String x, int a)
A String 47
Saving object:
Blip3.writeExternal
Recovering b3:
Blip3 Constructor
Blip3.readExternal
A String 47
*///:~
```
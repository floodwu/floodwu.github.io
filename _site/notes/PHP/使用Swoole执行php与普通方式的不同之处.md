# 使用Swoole执行php与普通方式的不同之处

使用swoole拓展的PHP脚本与传统的PHP脚步不同，前者是需要预先在服务端执行的，而后者是每次访问时才会执行。

比如你的程序中定义了一个类A，那么在每次有用户访问时，类A都需要提前编译到内存中，1万次访问就要编译1万次。而用swoole拓展则只需要在服务端编译一次，无论多少次访问都不需要再次编译了，只要swoole的进程存在，类A就会一直存在于内存中。

因此，使用swoole来编写常规项目时，需要将自己置身于第三方上帝的角色，而非访问者的角色来编写并阅读自己的代码。
比如：PHP入门时就必须要掌握的session，对于运用了swoole扩展的PHP程序而言，完全可以用一个变量来替换。
再比如：平时写PHP代码，完全不必担心内存使用，全局变量/函数/对象等，可以随便使用，因为PHP脚本执行结束后，内存自然会自行释放掉。但用swoole扩展的PHP程序，则必然要手动注销全局的变量/函数/对象等

php在fork子进程的时候，父进程的资源连接会被子进程获得，父进程本身会断掉。要解决这个问题只能在fork之后重新建连接。

`一定不可以多进程或多线程共同一个mysql或redis连接，否则消息会串`。每个进程或线程创建一个mysql的连接。连接断掉也就是mysql gone away之后进行重连。子进程退出后php引擎回清理回收所有的内存，关闭所有的连接。然后由于子进程和父进程共享内存，所以父进程里建立的连接等等也会被顺带关闭掉。

fpm本身是leader follower同步阻塞模型，同一时间只能处理一个请求，支持不了异步。